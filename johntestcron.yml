command_type: test
stepback: true
ignore:
  - "*.md" # don't schedule tests if a commit only changes markdown files
  - ".github/*" # github CODEOWNERS configuration

#######################################
#              Functions              #
#######################################
functions:
  get-project-and-modules:
    - command: git.get_project
      type: setup
      params:
        directory: evergreen
        token: ${github_token}
        shallow_clone: true
    - command: shell.exec
      type: setup
      params:
        working_dir: evergreen
        include_expansions_in_env: ["GOROOT"]
        shell: bash
        script: |
          # Downloading modules is flaky in the ubuntu1604-arm64 distros, because the TCP connection is sometimes reset
          # by the peer for unknown reasons (this does not happen in other distros). Retry the module download multiple
          # times to reduce the flakiness.
          for i in {1..5}; do
            make mod-tidy;
            [[ $? -eq 0 ]] && break;
          done

#######################################
#                Tasks                #
#######################################

tasks:
  - name: nonactive
    commands:
      - command: shell.exec
        params:
          - script: echo inactive 
  - name: testcron
    commands:
      - command: git.get_project
        params:
          directory: src
      - command: generate.tasks
        params:
          files:
            - src/tasks.json

#######################################
#            Buildvariants            #
#######################################
buildvariants:
  - name: ubuntu2204
    display_name: Ubuntu 22.04
    run_on:
      - ubuntu2204-small
      - ubuntu2204-large
    expansions:
      goos: linux
      goarch: amd64
      sign_macos: true
    cron: 0 0 * * THU
    tasks:
      - name: nonactive
      - name: testcron
        activate: true
 
