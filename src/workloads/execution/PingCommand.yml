SchemaVersion: 2018-07-01
Owner: "@mongodb/product-perf"
Description: >
  This is a simple test that runs ping command on MongoDB to meassure the latency of command dispatch.

Clients:
  Default:
    QueryOptions:
      maxPoolSize: 500

MaxPhases: &MaxPhases 6
ActorTemplates:
- TemplateName: PingTemplate
  Config:
    Name: {^Parameter: {Name: "Name", Default: "TwoThreadPing"}}
    Type: RunCommand
    Threads: {^Parameter: {Name: "Threads", Default: 2}}
    Phases:
      OnlyActiveInPhases:
        Active: {^Parameter: {Name: "Active", Default: [0]}}
        NopInPhasesUpTo: *MaxPhases
        PhaseConfig:
          Duration: {^Parameter: {Name: "Duration", Default: "30 seconds"}}
          GlobalRate: {^Parameter: {Name: "Rate", Default: "100 per 1 second"}}
          Database: admin
          Operations:
          - OperationName: RunCommand
            OperationIsQuiet: true
            OperationCommand:
              ping: 1

Actors:
- ActorFromTemplate:
    TemplateName: PingTemplate
    TemplateParameters:
      Name: TwoThreadsPingRateLimited
- ActorFromTemplate:
    TemplateName: PingTemplate
    TemplateParameters:
      Name: FourThreadsPingRateLimited
      Threads: 4
      Active: [1]
- ActorFromTemplate:
    TemplateName: PingTemplate
    TemplateParameters:
      Name: EightThreadsPingRateLimited
      Threads: 8
      Active: [2]
- ActorFromTemplate:
    TemplateName: PingTemplate
    TemplateParameters:
      Name: SixteenThreadsPingRateLimited
      Threads: 16
      Active: [3]
- ActorFromTemplate:
    TemplateName: PingTemplate
    TemplateParameters:
      Name: ThirtyTwoThreadsPingRateLimited
      Threads: 32
      Active: [4]
- ActorFromTemplate:
    TemplateName: PingTemplate
    TemplateParameters:
      Name: SixtyFourThreadsPingRateLimited
      Threads: 64
      Active: [5]
AutoRun:
- When:
    mongodb_setup:
      $eq:
      - replica
      - replica-tls-disabled
      - replica-telemetry
      - replica-ssl
      - replica-noflowcontrol
      - replica-maintenance-events
      - replica-last-lts-fcv
      - replica-last-continuous-fcv
      - replica-flowcontrol
      - replica-delay-mixed
      - replica-auth
      - replica-auth-cluster-delay
      - replica-audit
      - replica-all-feature-flags
      - replica-2node
      - replica-2node-fcbis
      - replica-1dayhistory-15gbwtcache
      - shard
      - shard-telemetry
      - shard-single
      - shard-single-stress
      - shard-longevity
