SchemaVersion: 2018-07-01
Owner: "@mongodb/service-architecture"
Description: |
  TODO

GlobalDefaults:
  Nop: &Nop {Nop: true}
  Database: &Database tiger
  Collection: &Collection tiger
  PaddingLength: &PaddingLength 64 # bytes
  OperationCount: &OperationCount 1000000
  WarmUpPeriod: &WarmUpPeriod 30 seconds
  RunPeriod: &RunPeriod 5 minutes
  Threads: &Threads 64

Clients:
  Default:
    QueryOptions:
      maxPoolSize: 500 

Actors:
- Name: CRUDOps
  Type: CrudActor
  Threads: 1
  Phases:
  - Repeat: 1
    Database: *Database
    Collection: *Collection
    Operations:
    - OperationName: drop
  - Repeat: 1 # only 1 document is needed for this workload
    Database: *Database
    Collection: *Collection
    Operations:
    - OperationName: insertOne
      OperationCommand:
        Document:
          _id: 1
          padding: {^FastRandomString: {length: *PaddingLength}}
  - *Nop
  - *Nop
  - *Nop
- Name: MTCrudOps
  Type: CrudActor
  Threads: *Threads
  Phases:
  - *Nop
  - *Nop
  - *Nop
  #- Repeat: *OperationCount
  - Duration: *RunPeriod
    Database: *Database
    Collection: *Collection
    Operations:
    - OperationName: findOne
      OperationCommand:
        Filter: {_id: 1}
  - *Nop
- Name: RunCommand
  Type: RunCommand
  Threads: *Threads
  Phases:
  - *Nop
  - *Nop
  - Duration: *WarmUpPeriod
    Database: *Database
    Collection: *Collection
    Operations:
    - OperationMetricsName: hello
      OperationName: RunCommand
      OperationIsQuiet: true
      OperationCommand:
        hello: 1
  - *Nop
  #- Repeat: *OperationCount
  - Duration: *RunPeriod
    Database: *Database
    Collection: *Collection
    Operations:
    - OperationMetricsName: ping
      OperationName: RunCommand
      OperationIsQuiet: true
      OperationCommand:
        ping: 1

# Guard against timeout for no output.
- Name: LoggingActor
  Type: LoggingActor
  Threads: 1
  Phases:
  - *Nop
  - *Nop
  - *Nop
  - LogEvery: 5 minutes
    Blocking: None
  - LogEvery: 5 minutes
    Blocking: None

AutoRun:
- When:
    mongodb_setup:
      $eq: standalone
