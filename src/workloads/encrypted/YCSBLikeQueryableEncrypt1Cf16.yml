SchemaVersion: 2018-07-01
Owner: "@10gen/server-security"
Description: |
  Mimics a YCSB workload, with queryable encryption enabled. Performs queries on an encrypted
  field, instead of _id, during the read/update phase. Note that this test was originally
  two separate files, YCSBLikeQueryableEncrypt1Cf16.yml and YCSBLikeQueryableEncrypt1Cf16Sharded.yml,
  but was merged into one as part of PERF-4347.

Encryption:
  UseCryptSharedLib: true
  CryptSharedLibPath: /data/workdir/mongocrypt/lib/mongo_crypt_v1.so
  EncryptedCollections:
  - Database: genny_qebench
    Collection: testcoll
    EncryptionType: queryable
    QueryableEncryptedFields:
      field0: { type: "string", queries: [{queryType: "equality", contention: 16}] }

Clients:
  EncryptedPool:
    QueryOptions:
      maxPoolSize: 400
    # Comment this section out to disable encryption
    EncryptionOptions:
      KeyVaultDatabase: "keyvault"
      KeyVaultCollection: "datakeys"
      EncryptedCollections:
      - genny_qebench.testcoll

LoadConfig:
  Path: ../../phases/encrypted/YCSBLikeEncryptedTemplate.yml
  Parameters:
    Database: genny_qebench
    Collection: testcoll
    Namespace: genny_qebench.testcoll
    ClientName: EncryptedPool

AutoRun:
- When:
    mongodb_setup:
      $eq:
      - single-replica-fle
      - shard-lite-fle
    branch_name:
      $gte: v7.0
