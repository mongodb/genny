SchemaVersion: 2018-07-01
Owner: "@mongodb/sharding"
Description: |

  This workload demonstrates using the GetMoreActor to repeatedly run a collection scan using both
  the find and aggregate commands.

GlobalDefaults:
  Nop: &Nop {Nop: true}

  Database: &Database test
  Collection: &Collection Collection0

Clients:
  Default:
    QueryOptions:
      maxPoolSize: 104

Actors:
- Name: LoadInitialData
  Type: MonotonicSingleLoader
  Threads: 100
  Phases:
  - Repeat: 1
    Database: *Database
    Collection: *Collection
    BatchSize: 1000
    DocumentCount: 100_000
    Document: {x: {^RandomInt: {min: 0, max: 100}}}
  - *Nop
  - *Nop

- Name: CollectionScanFind
  Type: GetMoreActor
  Threads: 2
  Database: test
  Phases:
  - *Nop
  - Repeat: 5
    Database: *Database
    InitialCursorCommand:
      find: *Collection
      batchSize: 101
    GetMoreBatchSize: 2000
  - *Nop

- Name: CollectionScanAggregate
  Type: GetMoreActor
  Threads: 2
  Database: test
  Phases:
  - *Nop
  - *Nop
  - Repeat: 5
    Database: *Database
    InitialCursorCommand:
      aggregate: *Collection
      pipeline: []
      cursor:
        batchSize: 101
    GetMoreBatchSize: 2000
