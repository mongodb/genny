SchemaVersion: 2018-07-01
Owner: "@mongodb/query"
Description: >
  This workload contains centralized configurations for testing performance of IDHACK on various int
  queries, such as point queries and range queries, by providing general setup and scaffolding.

KeyWords:
- IDHACK

GlobalDefaults:
  Database: &Database test
  Collection: &Collection Collection0
  MaxPhases: &MaxPhases 512

ActorTemplateConfig:
  Name: {^Parameter: {Name: "Name", Default: {unused: "Need to specify the actor name."}}}
  Type: CrudActor
  Threads: {^Parameter: {Name: "Threads", Default: {unused: "Need to specify the number of threads."}}}
  Phases:
    OnlyActiveInPhases:
      Active: [{^Parameter: {Name: "OnlyActiveInPhase", Default: {unused: "Need to specify in which phases this actor should be active."}}}]
      NopInPhasesUpTo: {^Parameter: {Name: "MaxPhases", Default: *MaxPhases}}
      PhaseConfig:
        Duration: 5 minutes
        Database: {^Parameter: {Name: "Database", Default: *Database}}
        Collection: {^Parameter: {Name: "Collection", Default: *Collection}}
        Operations: {^Parameter: {Name: "Operations", Default: {unused: "Need to specify the actor template operations"}}}

# Clear any pre-existing collection state.
ClearCollectionActor:
  Name: ClearCollection
  Type: CrudActor
  Database: {^Parameter: {Name: "Database", Default: *Database}}
  Threads: 1
  Phases:
    OnlyActiveInPhases:
      Active: [0]
      NopInPhasesUpTo: {^Parameter: {Name: "MaxPhases", Default: *MaxPhases}}
      PhaseConfig:
        Repeat: 1
        Threads: 1
        Collection: {^Parameter: {Name: "Collection", Default: *Collection}}
        Operations:
        - OperationName: drop

PrepopulateActor:
  Name: Prepopulate
  Type: Loader
  Threads: 10
  Phases:
    OnlyActiveInPhases:
      Active: [1]
      NopInPhasesUpTo: {^Parameter: {Name: "MaxPhases", Default: *MaxPhases}}
      PhaseConfig:
        Repeat: 1
        Database: {^Parameter: {Name: "Database", Default: *Database}}
        MultipleThreadsPerCollection: true
        CollectionCount: 1
        # This is set as a parameter so that local testing won't take forever to build the index.
        DocumentCount: {^Parameter: {Name: "Documents", Default: 10000000}}
        BatchSize: 1000
        Document: {^Parameter: {Name: "Document", Default: {unused: "Need to specify documents to load."}}}
        Indexes: {^Parameter: {Name: "Indexes", Default: []}}

QuiesceActor:
  Name: Quiesce
  Type: QuiesceActor
  Threads: 1
  Database: {^Parameter: {Name: "Database", Default: *Database}}
  Phases:
    OnlyActiveInPhases:
      Active: {^Parameter: {Name: "Phases", Default: [2]}}
      NopInPhasesUpTo: {^Parameter: {Name: "MaxPhases", Default: *MaxPhases}}
      PhaseConfig:
        Repeat: 1
