SchemaVersion: 2018-07-01
Owner: "@mongodb/sys-perf"
Description: |
  This workload is designed to insert a document, update it and then immediately delete it
  (this is repeated 10k times). This is designed to help us calculate CPU cycle metrics when
  utilizing the Linux 3-Node ReplSet CPU Cycle Metrics 2023-06 variant for a mixed workload

dbname: &dbname 10kDocs
CollectionCount: &NumColls 1

NumPhases: &NumPhases 1

Actors:
- Name: CrudActor
  Type: CrudActor
  Database: *dbname
  Threads: 1
  Phases:
    OnlyActiveInPhases:
      Active: [0]
      NopInPhasesUpTo: *NumPhases
      PhaseConfig:
        Repeat: 10000
        RecordFailure: true
        CollectionCount: *NumColls
        Operation:
          OperationName: bulkWrite
          OperationCommand:
            WriteOperations:
            - WriteCommand: insertOne
              Document: { a: 1 }
            - WriteCommand: updateOne
              Filter: { a: 1}
              Update: { $set: { a: 5} }
            - WriteCommand: deleteOne
              Filter: { a: 5 }
          OperationMetricsName: MixedActor
          ThrowOnFailure: true

AutoRun:
- When:
    mongodb_setup:
      $eq:
      - replica-ipc-counters.2023-06